"use strict";exports.id=451,exports.ids=[451],exports.modules={9884:(e,t,s)=>{s.d(t,{Z:()=>Comments});var a=s(997),n=s(6689),i=s(2885);let c=(0,i.createClient)("https://pgsvorcullkrgmcbpszb.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBnc3ZvcmN1bGxrcmdtY2Jwc3piIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU0MzM2OTksImV4cCI6MjA3MTAwOTY5OX0.75yAzHMjHxkR8EPAMKFlj6o31qhxgUIN1WmzMe2VlS4");function Comments({listId:e,itemId:t}){let[s,i]=(0,n.useState)(null),[r,o]=(0,n.useState)([]),[l,m]=(0,n.useState)(""),[d,h]=(0,n.useState)(!1);async function load(){let a=new URLSearchParams;e&&a.set("listId",e),t&&a.set("itemId",t);let n={};s?.access_token&&(n.Authorization=`Bearer ${s.access_token}`);let i=await fetch(`/api/comments?${a.toString()}`,{headers:n}),c=await i.json();o(c||[])}async function submit(a){if(!s?.access_token){alert("برای ارسال نظر ابتدا وارد شوید.");return}let n=a?prompt("پاسخ شما:"):l;if(!n||!n.trim())return;h(!0);let i={content:n,parentId:a};e&&(i.listId=e),t&&(i.itemId=t);let c=await fetch("/api/comments",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.access_token}`},body:JSON.stringify(i)});if(h(!1),c.ok)m(""),load();else{let e=await c.json().catch(()=>({}));alert(e?.error||"خطا در ارسال نظر")}}async function remove(e){if(!s?.access_token||!confirm("آیا از حذف نظر مطمئنید؟"))return;let t=await fetch(`/api/comments/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${s.access_token}`}});t.ok?load():alert("حذف ناموفق")}return(0,n.useEffect)(()=>{c.auth.getSession().then(({data:e})=>i(e.session));let{data:e}=c.auth.onAuthStateChange((e,t)=>i(t));return()=>e.subscription.unsubscribe()},[]),(0,n.useEffect)(()=>{load()},[e,t,s?.access_token]),(0,a.jsxs)("div",{className:"mt-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"نظرات"}),a.jsx("div",{className:"space-y-3",children:r.map(e=>a.jsx(CommentNode,{c:e,onReply:()=>submit(e.id),onDelete:()=>remove(e.id)},e.id))}),(0,a.jsxs)("div",{className:"mt-4 flex gap-2",children:[a.jsx("input",{className:"flex-1",placeholder:"نظر خود را بنویسید...",value:l,onChange:e=>m(e.target.value)}),a.jsx("button",{className:"btn btn-primary",disabled:d||!l.trim(),onClick:()=>submit(),children:"ارسال"})]})]})}function CommentNode({c:e,onReply:t,onDelete:s}){let n=new Date(e.created_at).toLocaleString("fa-IR");return(0,a.jsxs)("div",{className:"p-3 border rounded-xl bg-white/70 dark:bg-slate-900/40",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[a.jsx("div",{className:"font-medium",children:e.user_email||"کاربر"}),a.jsx("div",{className:"text-xs opacity-60",children:n})]}),a.jsx("div",{className:"mt-2",children:e.content}),(0,a.jsxs)("div",{className:"mt-2 flex gap-2 text-sm",children:[a.jsx("button",{className:"btn",onClick:t,children:"پاسخ"}),a.jsx("button",{className:"btn",onClick:s,children:"حذف"})]}),e.children&&e.children.length>0&&a.jsx("div",{className:"mt-3 space-y-2 pr-4 border-r",children:e.children.map(e=>a.jsx(CommentNode,{c:e,onReply:t,onDelete:s},e.id))})]})}},7719:(e,t,s)=>{s.d(t,{Z:()=>ShareButtons});var a=s(997);function ShareButtons({title:e,url:t}){let s=t||"",share=async()=>{if(navigator.share)try{await navigator.share({title:e,url:s})}catch{}else{let t=`https://twitter.com/intent/tweet?text=${encodeURIComponent(e)}&url=${encodeURIComponent(s)}`;window.open(t,"_blank")}};return a.jsx("button",{className:"btn",onClick:share,children:"اشتراک‌گذاری"})}}};