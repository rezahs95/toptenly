"use strict";(()=>{var e={};e.id=742,e.ids=[742],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5125:(e,t,r)=>{r.r(t),r.d(t,{config:()=>u,default:()=>o,routeModule:()=>l});var a={};r.r(a),r.d(a,{default:()=>handler});var s=r(1802),i=r(7153),d=r(6249),n=r(6962);async function handler(e,t){if("GET"===e.method){let{listId:r}=e.query,a=e.headers.authorization;if(r){let e=null;if(a?.startsWith("Bearer ")){let t=a.split(" ")[1],{data:r}=await n.R.auth.getUser(t);e=r?.user?.id||null}if(!e)return t.json({favorited:!1});let{data:s}=await n.R.from("favorites").select("id").eq("user_id",e).eq("list_id",r);return t.json({favorited:(s||[]).length>0})}if(!a||!a.startsWith("Bearer "))return t.json([]);let s=a.split(" ")[1],{data:i}=await n.R.auth.getUser(s),d=i?.user;if(!d)return t.json([]);let{data:o}=await n.R.from("favorites").select("list_id,created_at").eq("user_id",d.id).order("created_at",{ascending:!1});if(!o||0===o.length)return t.json([]);let u=o.map(e=>e.list_id),{data:l}=await n.R.from("lists").select("id,title,created_at").in("id",u),f={};(l||[]).forEach(e=>f[e.id]=e);let _=o.map(e=>({...f[e.list_id],created_at:e.created_at}));return t.json(_)}if("POST"===e.method){let r=e.headers.authorization;if(!r||!r.startsWith("Bearer "))return t.status(401).json({error:"not_authenticated"});let a=r.split(" ")[1],{data:s}=await n.R.auth.getUser(a),i=s?.user;if(!i)return t.status(401).json({error:"invalid_token"});let{listId:d}=e.body;if(!d)return t.status(400).json({error:"missing_listId"});let{error:o}=await n.R.from("favorites").insert([{user_id:i.id,list_id:d}]);return o?t.status(500).json({error:"db_error"}):t.json({ok:!0})}return t.status(405).end()}let o=(0,d.l)(a,"default"),u=(0,d.l)(a,"config"),l=new s.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/favorites",pathname:"/api/favorites",bundlePath:"",filename:""},userland:a})},6962:(e,t,r)=>{r.d(t,{R:()=>i});let a=require("@supabase/supabase-js"),s=process.env.SUPABASE_SERVICE_ROLE_KEY,i=(0,a.createClient)("https://pgsvorcullkrgmcbpszb.supabase.co",s,{auth:{persistSession:!1}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[222],()=>__webpack_exec__(5125));module.exports=r})();