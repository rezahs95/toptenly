(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(281)}])},9884:function(e,t,s){"use strict";s.d(t,{Z:function(){return Comments}});var n=s(5893),a=s(7294),i=s(1608);let c=(0,i.eI)("https://pgsvorcullkrgmcbpszb.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBnc3ZvcmN1bGxrcmdtY2Jwc3piIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU0MzM2OTksImV4cCI6MjA3MTAwOTY5OX0.75yAzHMjHxkR8EPAMKFlj6o31qhxgUIN1WmzMe2VlS4");function Comments(e){let{listId:t,itemId:s}=e,[i,l]=(0,a.useState)(null),[r,o]=(0,a.useState)([]),[d,u]=(0,a.useState)(""),[m,h]=(0,a.useState)(!1);async function load(){let e=new URLSearchParams;t&&e.set("listId",t),s&&e.set("itemId",s);let n={};(null==i?void 0:i.access_token)&&(n.Authorization="Bearer ".concat(i.access_token));let a=await fetch("/api/comments?".concat(e.toString()),{headers:n}),c=await a.json();o(c||[])}async function submit(e){if(!(null==i?void 0:i.access_token)){alert("برای ارسال نظر ابتدا وارد شوید.");return}let n=e?prompt("پاسخ شما:"):d;if(!n||!n.trim())return;h(!0);let a={content:n,parentId:e};t&&(a.listId=t),s&&(a.itemId=s);let c=await fetch("/api/comments",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(i.access_token)},body:JSON.stringify(a)});if(h(!1),c.ok)u(""),load();else{let e=await c.json().catch(()=>({}));alert((null==e?void 0:e.error)||"خطا در ارسال نظر")}}async function remove(e){if(!(null==i?void 0:i.access_token)||!confirm("آیا از حذف نظر مطمئنید؟"))return;let t=await fetch("/api/comments/".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(i.access_token)}});t.ok?load():alert("حذف ناموفق")}return(0,a.useEffect)(()=>{c.auth.getSession().then(e=>{let{data:t}=e;return l(t.session)});let{data:e}=c.auth.onAuthStateChange((e,t)=>l(t));return()=>e.subscription.unsubscribe()},[]),(0,a.useEffect)(()=>{load()},[t,s,null==i?void 0:i.access_token]),(0,n.jsxs)("div",{className:"mt-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"نظرات"}),(0,n.jsx)("div",{className:"space-y-3",children:r.map(e=>(0,n.jsx)(CommentNode,{c:e,onReply:()=>submit(e.id),onDelete:()=>remove(e.id)},e.id))}),(0,n.jsxs)("div",{className:"mt-4 flex gap-2",children:[(0,n.jsx)("input",{className:"flex-1",placeholder:"نظر خود را بنویسید...",value:d,onChange:e=>u(e.target.value)}),(0,n.jsx)("button",{className:"btn btn-primary",disabled:m||!d.trim(),onClick:()=>submit(),children:"ارسال"})]})]})}function CommentNode(e){let{c:t,onReply:s,onDelete:a}=e,i=new Date(t.created_at).toLocaleString("fa-IR");return(0,n.jsxs)("div",{className:"p-3 border rounded-xl bg-white/70 dark:bg-slate-900/40",children:[(0,n.jsxs)("div",{className:"flex justify-between items-start",children:[(0,n.jsx)("div",{className:"font-medium",children:t.user_email||"کاربر"}),(0,n.jsx)("div",{className:"text-xs opacity-60",children:i})]}),(0,n.jsx)("div",{className:"mt-2",children:t.content}),(0,n.jsxs)("div",{className:"mt-2 flex gap-2 text-sm",children:[(0,n.jsx)("button",{className:"btn",onClick:s,children:"پاسخ"}),(0,n.jsx)("button",{className:"btn",onClick:a,children:"حذف"})]}),t.children&&t.children.length>0&&(0,n.jsx)("div",{className:"mt-3 space-y-2 pr-4 border-r",children:t.children.map(e=>(0,n.jsx)(CommentNode,{c:e,onReply:s,onDelete:a},e.id))})]})}},7719:function(e,t,s){"use strict";s.d(t,{Z:function(){return ShareButtons}});var n=s(5893);function ShareButtons(e){let{title:t,url:s}=e,a=s||window.location.href,share=async()=>{if(navigator.share)try{await navigator.share({title:t,url:a})}catch(e){}else{let e="https://twitter.com/intent/tweet?text=".concat(encodeURIComponent(t),"&url=").concat(encodeURIComponent(a));window.open(e,"_blank")}};return(0,n.jsx)("button",{className:"btn",onClick:share,children:"اشتراک‌گذاری"})}},281:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return Home}});var n=s(5893),a=s(7294),i=s(6976),c=s(1608);let l=(0,c.eI)("https://pgsvorcullkrgmcbpszb.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBnc3ZvcmN1bGxrcmdtY2Jwc3piIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU0MzM2OTksImV4cCI6MjA3MTAwOTY5OX0.75yAzHMjHxkR8EPAMKFlj6o31qhxgUIN1WmzMe2VlS4");function VoteButtons(e){let{listId:t,itemId:s}=e,[i,c]=(0,a.useState)(null),[r,o]=(0,a.useState)([]),[d,u]=(0,a.useState)(!1);async function runRecaptcha(){let e="YOUR_RECAPTCHA_SITE_KEY",t=window.grecaptcha;if(!e||!t||!t.execute)return null;try{return await t.execute(e,{action:"vote"})}catch(e){return null}}async function vote(e){if(!(null==i?void 0:i.access_token)){alert("برای رأی دادن ابتدا وارد شوید.");return}if(r.includes(e)){alert("شما از رأی ".concat(e," قبلاً استفاده کرده‌اید."));return}u(!0);let n=await runRecaptcha(),a=await fetch("/api/vote",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(i.access_token)},body:JSON.stringify({listId:t,itemId:s,weight:e,captchaToken:n})}),c=await a.json().catch(()=>({}));if(u(!1),!a.ok){alert((null==c?void 0:c.error)||"خطا در ثبت رأی");return}o(t=>[...t,e]),window.location.reload()}return(0,a.useEffect)(()=>{l.auth.getSession().then(e=>{let{data:t}=e;return c(t.session)});let{data:e}=l.auth.onAuthStateChange((e,t)=>{c(null!=t?t:null)});return async function(){let e=null==i?void 0:i.access_token;if(!e)return;let s=await fetch("/api/user/votes?listId=".concat(t),{headers:{Authorization:"Bearer ".concat(e)}});if(s.ok){let e=await s.json();o(e.used||[])}}(),()=>e.subscription.unsubscribe()},[t,null==i?void 0:i.access_token]),(0,n.jsxs)("div",{className:"flex gap-1",children:[(0,n.jsx)("button",{disabled:d||r.includes(3),onClick:()=>vote(3),className:"px-2 py-1 border rounded",children:r.includes(3)?"۳ ✓":"۳"}),(0,n.jsx)("button",{disabled:d||r.includes(2),onClick:()=>vote(2),className:"px-2 py-1 border rounded",children:r.includes(2)?"۲ ✓":"۲"}),(0,n.jsx)("button",{disabled:d||r.includes(1),onClick:()=>vote(1),className:"px-2 py-1 border rounded",children:r.includes(1)?"۱ ✓":"۱"})]})}var r=s(7719);let o=(0,c.eI)("https://pgsvorcullkrgmcbpszb.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBnc3ZvcmN1bGxrcmdtY2Jwc3piIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU0MzM2OTksImV4cCI6MjA3MTAwOTY5OX0.75yAzHMjHxkR8EPAMKFlj6o31qhxgUIN1WmzMe2VlS4");function FavoriteButton(e){let{listId:t}=e,[s,i]=(0,a.useState)(null),[c,l]=(0,a.useState)(!1),[r,d]=(0,a.useState)(!1);async function toggle(){if(!s){alert("برای افزودن به علاقه‌مندی‌ها ابتدا وارد شوید.");return}d(!0);let e=s.access_token;if(c){let s=await fetch("/api/favorites/".concat(t),{method:"DELETE",headers:{Authorization:"Bearer ".concat(e)}});s.ok&&l(!1)}else{let s=await fetch("/api/favorites",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({listId:t})});s.ok&&l(!0)}d(!1)}return(0,a.useEffect)(()=>{o.auth.getSession().then(e=>{let{data:t}=e;return i(t.session)});let{data:e}=o.auth.onAuthStateChange((e,t)=>i(t));return()=>e.subscription.unsubscribe()},[]),(0,a.useEffect)(()=>{(async function(){if(!t)return;let e={};(null==s?void 0:s.access_token)&&(e.Authorization="Bearer ".concat(s.access_token));let n=await fetch("/api/favorites?listId=".concat(t),{headers:e});if(n.ok){let e=await n.json();l(!!e.favorited)}})()},[t,null==s?void 0:s.access_token]),(0,n.jsx)("button",{onClick:toggle,disabled:r,className:"btn "+(c?"btn-primary":""),children:c?"در علاقه‌مندی‌ها ✓":"افزودن به علاقه‌مندی‌ها"})}var d=s(9884);let fetcher=e=>fetch(e).then(e=>e.json());function Home(){let[e,t]=(0,a.useState)(""),{data:s}=(0,i.ZP)("/api/popular",fetcher,{revalidateOnFocus:!1}),{data:c}=(0,i.ZP)("/api/trending",fetcher,{revalidateOnFocus:!1}),[l,r]=(0,a.useState)(null),[o,d]=(0,a.useState)(!1);async function onSearch(t){if(t&&t.preventDefault(),!e.trim())return;d(!0);let s=await fetch("/api/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e})}),n=await s.json();r(n),d(!1),history.replaceState(null,"","/?q=".concat(encodeURIComponent(e)))}return(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"card p-6",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold mb-4",children:"کشف بهترین‌ها و بدترین‌ها — تاپ ۱۰ در هر چیز"}),(0,n.jsxs)("form",{onSubmit:onSearch,className:"flex gap-2",children:[(0,n.jsx)("input",{value:e,onChange:e=>t(e.target.value),className:"flex-1",placeholder:"مثلا: بهترین رستوران نیویورک"}),(0,n.jsx)("button",{className:"btn btn-primary",children:o?"در حال جستجو...":"جستجو"})]}),(0,n.jsx)("div",{className:"mt-3 text-sm opacity-70",children:"مثال‌ها: بهترین گوشی گیمینگ، بدترین شهر اسپانیا برای سفر، بهترین سریال ۲۰۲۴"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,n.jsxs)("div",{className:"card p-4",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"بیشترین جستجوها"}),(0,n.jsx)("ol",{className:"space-y-1",children:(s||[]).map(e=>(0,n.jsxs)("li",{className:"flex justify-between",children:[(0,n.jsx)("span",{children:e.query}),(0,n.jsx)("span",{className:"opacity-60",children:e.count})]},e.query))})]}),(0,n.jsxs)("div",{className:"card p-4",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"ترندترین تاپ ۱۰ ها"}),(0,n.jsx)("ol",{className:"space-y-1",children:(c||[]).map(e=>(0,n.jsxs)("li",{className:"flex justify-between",children:[(0,n.jsx)("a",{href:"/?q=".concat(encodeURIComponent(e.title)),children:e.title}),(0,n.jsx)("span",{className:"opacity-60",children:e.vote_sum})]},e.id))})]})]}),(0,n.jsx)("div",{className:"",children:l&&(0,n.jsx)(ResultView,{data:l})})]})}function ResultView(e){let{data:t}=e;return(0,n.jsxs)("div",{className:"card p-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-xl font-semibold",children:t.list.title}),(0,n.jsxs)("p",{className:"text-sm opacity-70",children:["منبع: ",t.list.source]})]}),(0,n.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,n.jsx)(FavoriteButton,{listId:t.list.id}),(0,n.jsx)(r.Z,{title:"تاپ ۱۰: ".concat(t.list.title)})]})]}),(0,n.jsx)("ol",{className:"mt-4 space-y-3",children:t.list.items.map((e,s)=>{var a;return(0,n.jsxs)("li",{className:"p-3 border rounded-xl bg-white/70 dark:bg-slate-900/40",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"font-medium",children:["#",s+1," — ",e.title]}),e.description&&(0,n.jsx)("div",{className:"text-sm opacity-80",children:e.description})]}),(0,n.jsxs)("div",{className:"text-right text-sm",children:[(0,n.jsxs)("div",{children:["امتیاز: ",null!==(a=e.score)&&void 0!==a?a:0]}),(0,n.jsx)("a",{className:"text-blue-600",href:"/item/".concat(e.id),children:"صفحهٔ آیتم"})]})]}),(0,n.jsx)("div",{className:"mt-2",children:(0,n.jsx)(VoteButtons,{listId:t.list.id,itemId:e.id})})]},e.id)})}),(0,n.jsx)(d.Z,{listId:t.list.id})]})}}},function(e){e.O(0,[976,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);