(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[591],{4524:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/item/[id]",function(){return n(6199)}])},9884:function(e,t,n){"use strict";n.d(t,{Z:function(){return Comments}});var s=n(5893),a=n(7294),c=n(1608);let i=(0,c.eI)("https://pgsvorcullkrgmcbpszb.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBnc3ZvcmN1bGxrcmdtY2Jwc3piIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU0MzM2OTksImV4cCI6MjA3MTAwOTY5OX0.75yAzHMjHxkR8EPAMKFlj6o31qhxgUIN1WmzMe2VlS4");function Comments(e){let{listId:t,itemId:n}=e,[c,l]=(0,a.useState)(null),[o,r]=(0,a.useState)([]),[d,u]=(0,a.useState)(""),[m,h]=(0,a.useState)(!1);async function load(){let e=new URLSearchParams;t&&e.set("listId",t),n&&e.set("itemId",n);let s={};(null==c?void 0:c.access_token)&&(s.Authorization="Bearer ".concat(c.access_token));let a=await fetch("/api/comments?".concat(e.toString()),{headers:s}),i=await a.json();r(i||[])}async function submit(e){if(!(null==c?void 0:c.access_token)){alert("برای ارسال نظر ابتدا وارد شوید.");return}let s=e?prompt("پاسخ شما:"):d;if(!s||!s.trim())return;h(!0);let a={content:s,parentId:e};t&&(a.listId=t),n&&(a.itemId=n);let i=await fetch("/api/comments",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(c.access_token)},body:JSON.stringify(a)});if(h(!1),i.ok)u(""),load();else{let e=await i.json().catch(()=>({}));alert((null==e?void 0:e.error)||"خطا در ارسال نظر")}}async function remove(e){if(!(null==c?void 0:c.access_token)||!confirm("آیا از حذف نظر مطمئنید؟"))return;let t=await fetch("/api/comments/".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(c.access_token)}});t.ok?load():alert("حذف ناموفق")}return(0,a.useEffect)(()=>{i.auth.getSession().then(e=>{let{data:t}=e;return l(t.session)});let{data:e}=i.auth.onAuthStateChange((e,t)=>l(t));return()=>e.subscription.unsubscribe()},[]),(0,a.useEffect)(()=>{load()},[t,n,null==c?void 0:c.access_token]),(0,s.jsxs)("div",{className:"mt-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"نظرات"}),(0,s.jsx)("div",{className:"space-y-3",children:o.map(e=>(0,s.jsx)(CommentNode,{c:e,onReply:()=>submit(e.id),onDelete:()=>remove(e.id)},e.id))}),(0,s.jsxs)("div",{className:"mt-4 flex gap-2",children:[(0,s.jsx)("input",{className:"flex-1",placeholder:"نظر خود را بنویسید...",value:d,onChange:e=>u(e.target.value)}),(0,s.jsx)("button",{className:"btn btn-primary",disabled:m||!d.trim(),onClick:()=>submit(),children:"ارسال"})]})]})}function CommentNode(e){let{c:t,onReply:n,onDelete:a}=e,c=new Date(t.created_at).toLocaleString("fa-IR");return(0,s.jsxs)("div",{className:"p-3 border rounded-xl bg-white/70 dark:bg-slate-900/40",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsx)("div",{className:"font-medium",children:t.user_email||"کاربر"}),(0,s.jsx)("div",{className:"text-xs opacity-60",children:c})]}),(0,s.jsx)("div",{className:"mt-2",children:t.content}),(0,s.jsxs)("div",{className:"mt-2 flex gap-2 text-sm",children:[(0,s.jsx)("button",{className:"btn",onClick:n,children:"پاسخ"}),(0,s.jsx)("button",{className:"btn",onClick:a,children:"حذف"})]}),t.children&&t.children.length>0&&(0,s.jsx)("div",{className:"mt-3 space-y-2 pr-4 border-r",children:t.children.map(e=>(0,s.jsx)(CommentNode,{c:e,onReply:n,onDelete:a},e.id))})]})}},7719:function(e,t,n){"use strict";n.d(t,{Z:function(){return ShareButtons}});var s=n(5893);function ShareButtons(e){let{title:t,url:n}=e,a=n||window.location.href,share=async()=>{if(navigator.share)try{await navigator.share({title:t,url:a})}catch(e){}else{let e="https://twitter.com/intent/tweet?text=".concat(encodeURIComponent(t),"&url=").concat(encodeURIComponent(a));window.open(e,"_blank")}};return(0,s.jsx)("button",{className:"btn",onClick:share,children:"اشتراک‌گذاری"})}},6199:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return ItemPage}});var s=n(5893),a=n(1163),c=n(7294),i=n(7719),l=n(9884);function ItemPage(){var e;let t=(0,a.useRouter)(),{id:n}=t.query,[o,r]=(0,c.useState)(null);if((0,c.useEffect)(()=>{n&&fetch("/api/item/".concat(n)).then(e=>e.json()).then(e=>r(e))},[n]),!o)return(0,s.jsx)("div",{className:"card p-6",children:"در حال بارگذاری..."});let d="آیتم: ".concat(o.title);return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"card p-6",children:(0,s.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:o.title}),o.description&&(0,s.jsx)("p",{className:"mt-2 opacity-80",children:o.description}),(0,s.jsxs)("p",{className:"mt-3",children:["امتیاز: ",null!==(e=o.score)&&void 0!==e?e:0]}),(0,s.jsx)("a",{className:"text-blue-600",href:"/?q=".concat(encodeURIComponent(o.list_title)),children:"بازگشت به لیست"})]}),(0,s.jsx)(i.Z,{title:d})]})}),(0,s.jsx)(l.Z,{itemId:String(n)})]})}},1163:function(e,t,n){e.exports=n(9974)}},function(e){e.O(0,[774,888,179],function(){return e(e.s=4524)}),_N_E=e.O()}]);